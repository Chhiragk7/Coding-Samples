$(function(){function t(t){var e=document.getElementById("total-hit-count");e.innerHTML=t,$("#total-hit-spinner").hide()}function e(t){for(var e=0,a=0,n=[],o=[],l=0;l<t.length;l++)"SERVICE"==t[l].SALE_SERVICE_FLAG?(e++,n.push(t[l])):"SALES"==t[l].SALE_SERVICE_FLAG&&(a++,o.push(t[l]));r(e,a),g(n,e),f(o,a)}function r(t,e){var r=[{value:t,color:"#F7464A",highlight:"#FF5A5E",label:"Service"},{value:e,color:"#46BFBD",highlight:"#5AD3D1",label:"Sales"}],a=document.getElementById("doughnut-chart").getContext("2d");b=new Chart(a).Doughnut(r,""),$("#sale-service-doughnut").hide()}function a(t){d(t),h(t),v(t)}function n(t){for(var e=[],r=0;r<t.length;r++)e.push(t[r].REP_NAME);return e}function o(t){for(var e=[],r=0;r<t.length;r++)e.push(t[r].KEY_DRIVER_ANSWER);return e}function l(t){for(var e=[],r=0;r<t.length;r++)e.push(t[r].CITY);return e}function i(t){if(0==t.length)return 0;for(var e={},r=[],a=0;a<t.length;a++){var n=t[a];e[n]=e[n]?e[n]+1:1}var o=[];for(var l in e)o.push([l,e[l]]);o.sort(function(t,e){return e[1]-t[1]});for(var a=0;10>a;a++)r.push(o[a]);return r}function s(t){var e=[];return e=$.grep(t,function(t){return t})}function d(t){var e=[];e=n(t),d=i(e),u(d)}function u(t){for(var e=0;e<t.length;e++){var r=e+1;$("#top-employees-legend").append("("+r+")&nbsp;"+t[e][0]+"&nbsp;")}var a={labels:["1","2","3","4","5","6","7","8","9","10"],datasets:[{label:"My First dataset",fillColor:"rgba(151,187,205,0.5)",strokeColor:"rgba(151,187,205,0.8)",highlightFill:"rgba(151,187,205,0.75)",highlightStroke:"rgba(151,187,205,1)",data:[t[0][1],t[1][1],t[2][1],t[3][1],t[4][1],t[5][1],t[6][1],t[7][1],t[8][1],t[9][1]]}]},n=document.getElementById("bar-chart-1").getContext("2d");C=new Chart(n).Bar(a,""),$("#barchart1").hide()}function h(t){var e=[];e=o(t);var r=[];r=s(e);var a=[];a=i(r),c(a)}function c(t){for(var e=0;e<t.length;e++){var r=t[e][0].toString().substr(2,t[e][0].length-4);S++,$("#top-chart-driver-legend").append("("+S+")&nbsp;"+r+"&nbsp;")}var a={labels:["1","2","3","4","5","6","7","8","9","10"],datasets:[{label:"My First dataset",fillColor:"rgba(151,187,205,0.5)",strokeColor:"rgba(151,187,205,0.8)",highlightFill:"rgba(151,187,205,0.75)",highlightStroke:"rgba(151,187,205,1)",data:[t[0][1],t[1][1],t[2][1],t[3][1],t[4][1],t[5][1],t[6][1],t[7][1],t[8][1],t[9][1]]}]},n=document.getElementById("bar-chart-2").getContext("2d");y=new Chart(n).Bar(a,""),$("#barchart2").hide()}function v(t){var e=[];e=l(t);var r=[];r=s(e);var a=[];a=i(r),E(a)}function g(t,e){var r=[];r=n(t);var a=[];a=i(r);var d=[];d=o(t);var u=[];u=s(d);var h=[];h=i(u);var c=[];c=l(t);var v=[];v=s(c);var g=[];g=i(v),p(a,h,e,g)}function p(t,e,r,a){$("#doughnut-chart").click(function(n){var o=b.getSegmentsAtEvent(n),l=o[0].label;if("Service"==l){$("#top-employees-legend").empty(),$("#top-chart-driver-legend").empty(),b.removeData(1);for(var i=0;i<t.length;i++){var s=i+1;$("#top-employees-legend").append("("+s+")&nbsp;"+t[i][0]),C.datasets[0].bars[i].value=t[i][1]}C.update();for(var i=0;i<e.length;i++){var d=e[i][0].toString().substr(2,e[i][0].length-4),s=i+1;$("#top-chart-driver-legend").append("("+s+")&nbsp;"+d),y.datasets[0].bars[i].value=e[i][1]}y.update(),d3.select("#word-cloud svg").remove(),E(a),$("#total-hit-count").fadeOut("slow",function(){$("#total-hit-count").fadeIn("slow").html(r)})}})}function f(t,e){var r=[];r=n(t);var a=[];a=i(r);var d=[];d=o(t);var u=[];u=s(d);var h=[];h=i(u);var c=[];c=l(t);var v=[];v=s(c);var g=[];g=i(v),m(a,h,e,g)}function m(t,e,r,a){$("#doughnut-chart").click(function(n){var o=b.getSegmentsAtEvent(n),l=o[0].label;if("Sales"==l){$("#top-employees-legend").empty(),b.removeData(0);for(var i=0;i<t.length;i++){var s=i+1;$("#top-employees-legend").append("("+s+")&nbsp;"+t[i][0]),C.datasets[0].bars[i].value=t[i][1]}if(C.update(),0==!e){for(var i=0;i<e.length;i++){var d=e[i][0].toString().substr(2,e[i][0].length-4),s=i+1;$("#top-chart-driver-legend").append("("+s+")&nbsp;"+d),y.datasets[0].bars[i].value=e[i][1]}y.update()}else{for(var i=0;10>i;i++)$("#top-chart-driver-legend").empty(),$("#top-chart-driver-legend").append("NOTHING TO DISPLAY"),y.datasets[0].bars[i].value=0;y.update()}d3.select("#word-cloud svg").remove(),E(a),$("#total-hit-count").fadeOut("slow",function(){$("#total-hit-count").fadeIn("slow").html(r)})}})}Chart.defaults.global.responsive=!0;var b;$.ajax({url:"chat.txt",dataType:"text",success:function(r){var n=[],o=r.split("\n")[0],l=o.split("---").pop();t(l);var i=r.split("\n");i.splice(0,1);for(var s=i[0].split("||@"),d=1;d<i.length;d++){for(var u={},h=i[d].split("||@"),c=0;c<s.length;c++)u[s[c]]=h[c];n.push(u)}var v=[];v=JSON.parse(JSON.stringify(n)),a(v),salesServiceRecord=JSON.parse(JSON.stringify(n)),e(salesServiceRecord)}});{var C,y,S=0,E=function(t){function e(t){d3.select("#word-cloud").append("svg").attr("id","word-cloud-responsive").attr("viewBox","0 0 750 550").attr("preserveAspectRatio","xMidYMid").attr("width",o.size()[0]).attr("height",o.size()[1]).append("g").attr("transform","translate("+o.size()[0]/2+","+o.size()[1]/2+")").selectAll("text").data(t).enter().append("text").style("font-size",function(t){return n(t[1])+"px"}).style("font-family","Impact").style("fill",function(t,e){return a(e)}).attr("text-anchor","middle").attr("transform",function(t){return"translate("+[t.x,t.y]+")rotate("+t.rotate+")"}).text(function(t){return t[0]})}var r=t,a=d3.scale.category20(),n=d3.scale.linear().range([10,60]);n.domain([d3.min(r,function(t){return t[1]}),d3.max(r,function(t){return t[1]})]);var o=d3.layout.cloud().size([750,550]).words(r).padding(5).font("Impact").fontSize(function(t){return n(t[1])}).on("end",e);o.start(),$("#word-cloud-spinner").hide()},w={labels:["asdsa","February","March","April","May","June","July"],datasets:[{label:"My First dataset",fillColor:"rgba(151,187,205,0.5)",strokeColor:"rgba(151,187,205,0.8)",highlightFill:"rgba(151,187,205,0.75)",highlightStroke:"rgba(151,187,205,1)",data:[23,59,80,81,56,55,40]}]},x=document.getElementById("line-chart").getContext("2d");new Chart(x).Line(w,"")}});var updateLineChartData=function(t,e,r){window.lineChart.destroy(),t=new Chart(t).Line(e,r),lineChartRandomColor(t,e)},updateBarChartData=function(t,e,r){for(var a=0;a<t.length;a++)t[a].destroy(),t[a]=new Chart(t[a]).Bar(e,r),barChartRandomColor(t[a],e)},lineChartRandomColor=function(t,e){for(var r=0;r<e.datasets[0].data.length;r++)t.datasets[0].fillColor=randomColor({luminosity:"random",hue:"random"});t.update()},barChartRandomColor=function(t,e){for(var r=0;r<e.datasets[0].data.length;r++)t.datasets[0].bars[r].fillColor=randomColor({luminosity:"random",hue:"random"});t.update()};